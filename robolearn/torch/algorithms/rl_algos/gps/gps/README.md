This algorithm is in process of being migrated completeley to pytorch